{% extends "base.html" %}

{% block title %}User Profile - Mindful Horizon{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="card p-6 mb-8">
        <form method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="flex items-center space-x-6 mb-6">
                <div class="flex-shrink-0">
                    <div class="text-center">
                        <img class="h-24 w-24 rounded-full object-cover border-4 border-purple-300 shadow-lg mx-auto mb-2"
                            src="{{ url_for('static', filename='profile_pics/' + (user.profile_pic or 'default.png')) }}"
                            alt="Profile Picture">
                        <label for="profile_pic" class="block text-sm font-medium text-gray-700">Profile Picture</label>
                        <input type="file" id="profile_pic" name="profile_pic" accept="image/*" class="block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-purple-50 file:text-purple-700
                            hover:file:bg-purple-100 mb-2" aria-describedby="profile_pic_help">
                        <small id="profile_pic_help" class="text-gray-500">Upload a new profile picture (optional)</small>
                    </div>
                </div>
                <div>
                    <label>Name:</label>
                    <input type="text" name="name" value="{{ user.name }}" class="block border rounded px-2 py-1 mb-2">
                    <label>Email:</label>
                    <input type="email" name="email" value="{{ user.email }}" class="block border rounded px-2 py-1 mb-2">
                    <label>College/Institution:</label>
                    <input type="text" name="institution" value="{{ user.institution }}" class="block border rounded px-2 py-1 mb-2" placeholder="Enter your college name">
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full text-sm" aria-label="Update your profile information">Update Profile</button>
                </div>
            </div>
        </form>
        <div class="grid md:grid-cols-2 gap-6">
            <!-- Gamification Summary -->
            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                    <i class="fas fa-trophy text-purple-500 mr-2"></i>Gamification Summary
                </h3>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li><strong>Total Points:</strong> {{ gamification.points if gamification else 0 }}</li>
                    <li><strong>Current Streak:</strong> {{ gamification.streak if gamification else 0 }} days</li>
                    <li><strong>Last Activity:</strong> {{ gamification.last_activity.strftime('%Y-%m-%d') if gamification and gamification.last_activity else 'N/A' }}</li>
                </ul>
            </div>
            <!-- Digital Wellness Snapshot -->
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                    <i class="fas fa-mobile-alt text-blue-500 mr-2"></i>Digital Wellness Snapshot
                </h3>
                <ul class="text-sm text-gray-700 space-y-1">
                    <li><strong>Avg. Screen Time (Last 7 Days):</strong> {{ '%.1f'|format(avg_screen_time_7_days) if avg_screen_time_7_days is not none else '0.0' }} hours</li>
                    <li><strong>Avg. Screen Time (Last 30 Days):</strong> {{ '%.1f'|format(avg_screen_time_30_days) if avg_screen_time_30_days is not none else '0.0' }} hours</li>
                    <li><strong>Latest AI Score:</strong> {{ digital_detox_logs[0].ai_score if digital_detox_logs and digital_detox_logs[0].ai_score else 'N/A' }}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Badges Earned Section -->
    <div class="card p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-medal text-yellow-500 mr-2"></i>Badges Earned
        </h2>
        <div class="flex flex-wrap gap-4">
            {% if gamification and gamification.badges %}
                {% for badge in gamification.badges %}
                <span class="badge-item bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-md font-medium shadow-sm">
                    <i class="fas fa-award mr-2"></i>{{ badge }}
                </span>
                {% endfor %}
            {% else %}
                <p class="text-gray-600">No badges earned yet. Keep engaging with Mindful Horizon to earn rewards!</p>
            {% endif %}
        </div>
    </div>

    <!-- Digital Detox Trends Section -->
    <div class="card p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-chart-line text-blue-500 mr-2"></i>Digital Detox Trends
        </h2>
        <ul class="text-gray-700 space-y-1">
            {% for log in digital_detox_logs %}
            <li>{{ log.date }}: {{ log.screen_time_hours }} hours (AI Score: {{ log.ai_score or 'N/A' }})</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Customizable Goals Display -->
    <div class="card p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-bullseye text-green-500 mr-2"></i>Your Goals
        </h2>
        <ul class="text-gray-700 space-y-1">
            {% for goal in goals %}
            <li>{{ goal.title }}: {{ goal.current_value }}/{{ goal.target_value }} {{ goal.unit }} ({{ goal.status }})</li>
            {% endfor %}
        </ul>
    </div>

</div>
{% endblock %}
