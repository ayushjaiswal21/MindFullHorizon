{% extends "base.html" %}

{% block title %}Progress Tracking - Mindful Horizon{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Your Mental Health Progress</h1>
        <p class="text-gray-600">Track your mental health journey with detailed insights and trends</p>
    </div>

    <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="card">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Anxiety Levels</h3>
                <i class="fas fa-heart text-blue-500 text-xl"></i>
            </div>
            <div class="text-3xl font-bold text-blue-600 mb-2">{{ latest_gad7.score if latest_gad7 else 'N/A' }}{% if latest_gad7 %}/21{% endif %}</div>
            <div class="text-sm text-gray-600 mb-3">Latest GAD-7 Score</div>
            <div class="flex items-center">
                {% if latest_gad7 %}
                    {% set severity_info = get_severity_info('GAD-7', latest_gad7.score) %}
                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-{{ severity_info.color }}-100 text-{{ severity_info.color }}-800">{{ severity_info.severity }}</span>
                {% else %}
                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">No Data</span>
                {% endif %}
                <span class="ml-2 text-sm text-gray-600">
                    </span>
            </div>
        </div>

        <div class="card">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Depression Screen</h3>
                <i class="fas fa-brain text-purple-500 text-xl"></i>
            </div>
            <div class="text-3xl font-bold text-purple-600 mb-2">{{ latest_phq9.score if latest_phq9 else 'N/A' }}{% if latest_phq9 %}/27{% endif %}</div>
            <div class="text-sm text-gray-600 mb-3">Latest PHQ-9 Score</div>
            <div class="flex items-center">
                {% if latest_phq9 %}
                    {% set severity_info = get_severity_info('PHQ-9', latest_phq9.score) %}
                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-{{ severity_info.color }}-100 text-{{ severity_info.color }}-800">{{ severity_info.severity }}</span>
                {% else %}
                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">No Data</span>
                {% endif %}
                <span class="ml-2 text-sm text-gray-600">
                    </span>
            </div>
        </div>

        <div class="card">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Overall Wellness</h3>
                <i class="fas fa-chart-line text-green-500 text-xl"></i>
            </div>
            <div class="text-3xl font-bold text-green-600 mb-2">{{ overall_wellness_score }}</div>
            <div class="text-sm text-gray-600 mb-3">AI Wellness Score</div>
            <div class="flex items-center">
                {% if overall_wellness_score != 'N/A' %}
                    {% set severity_info = get_severity_info('Daily Mood', overall_wellness_score) %}
                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-{{ severity_info.color }}-100 text-{{ severity_info.color }}-800">{{ severity_info.severity }}</span>
                {% else %}
                    <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">No Data</span>
                {% endif %}
                <span class="ml-2 text-sm text-gray-600">
                    </span>
            </div>
        </div>
    </div>

    <div class="grid lg:grid-cols-2 gap-8 mb-8">
        <div class="card">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-smile text-yellow-500 mr-2"></i>Mood Trends (Last 30 Days)
            </h3>
            <div class="bg-gray-50 p-4 rounded-lg mb-4" style="height: 250px;">
                <canvas id="moodChart"></canvas>
            </div>
            <div class="text-sm text-gray-600">
                <i class="fas fa-info-circle mr-2"></i>
                Your mood trends over time.
            </div>
        </div>

        <div class="card">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-chart-bar text-blue-500 mr-2"></i>Assessment Score History
            </h3>
            <div class="bg-gray-50 p-4 rounded-lg mb-4" style="height: 250px;">
                <canvas id="assessmentChart"></canvas>
            </div>
            <div class="text-sm text-gray-600">
                <i class="fas fa-info-circle mr-2"></i>
                Anxiety (GAD-7) and Depression (PHQ-9) scores over time.
            </div>
        </div>
    </div>

    <div class="card mb-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">
            <i class="fas fa-robot text-purple-500 mr-2"></i>AI Progress Analysis
        </h3>
        
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg mb-6">
            <h4 class="font-semibold text-gray-800 mb-3">Personalized Insights</h4>
            <div class="space-y-3 text-sm text-gray-700">
                <div class="flex items-start">
                    <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                    <span><strong>Positive Trend:</strong> Your anxiety levels have decreased by 25% over the past month, indicating effective coping strategies.</span>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-lightbulb text-yellow-500 mr-3 mt-1"></i>
                    <span><strong>Recommendation:</strong> Your mood dips typically occur on Mondays. Consider implementing weekend self-care routines.</span>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">
            <i class="fas fa-target text-red-500 mr-2"></i>Mental Health Goals
        </h3>
        <div id="goals-container" class="space-y-2">
            {% if goals %}
                {% for goal in goals %}
                <div class="flex items-center justify-between p-3 rounded-lg {% if goal.status == 'completed' %}bg-green-100{% else %}bg-gray-100{% endif %} hover:shadow-md transition-shadow">
                    <div class="flex items-center">
                        <input type="checkbox" data-goal-id="{{ goal.id }}" class="goal-checkbox form-checkbox h-5 w-5 text-blue-600" {% if goal.status == 'completed' %}checked{% endif %}>
                        <div class="ml-3">
                            <span class="text-gray-800 font-medium">{{ goal.title }}</span>
                            {% if goal.description %}
                            <p class="text-sm text-gray-600">{{ goal.description }}</p>
                            {% endif %}
                            {% if goal.target_value %}
                            <div class="text-xs text-gray-500 mt-1">
                                Progress: {{ goal.current_value }}{{ goal.unit if goal.unit else '' }} / {{ goal.target_value }}{{ goal.unit if goal.unit else '' }} 
                                ({{ "%.0f"|format(goal.progress_percentage) }}%)
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="px-2 py-1 text-xs rounded-full 
                            {% if goal.priority == 'high' %}bg-red-100 text-red-800
                            {% elif goal.priority == 'medium' %}bg-yellow-100 text-yellow-800
                            {% else %}bg-green-100 text-green-800{% endif %}">
                            {{ goal.priority }}
                        </span>
                        <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
                            {{ goal.category.replace('_', ' ') }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-bullseye text-4xl mb-3"></i>
                    <p class="text-lg mb-2">No goals yet</p>
                    <p class="text-sm mb-4">Start by creating your first mental health goal!</p>
                    <a href="{{ url_for('patient.goals') }}" class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Create Goal
                    </a>
                </div>
            {% endif %}
        </div>
        
    </div>

    <div class="card mb-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">
            <i class="fas fa-trophy text-yellow-500 mr-2"></i>Achievements
        </h3>
        <ul id="achievements-list" class="space-y-2 text-sm text-green-700">
            {% for achievement in achievements %}
            <li class="flex items-center">
                <i class="fas fa-star text-yellow-500 mr-2"></i>
                {{ achievement }}
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
        <div class="card">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-tasks text-orange-500 mr-2"></i>Recommended Actions
            </h3>
            <div class="space-y-3">
                {% for action in ai_recommendations.actions %}
                <div class="flex items-start p-3 {% if action.priority == 'high' %}bg-red-50{% elif action.priority == 'medium' %}bg-orange-50{% else %}bg-blue-50{% endif %} rounded-lg">
                    <i class="fas {% if action.priority == 'high' %}fa-exclamation-triangle text-red-500{% elif action.priority == 'medium' %}fa-lightbulb text-orange-500{% else %}fa-info-circle text-blue-500{% endif %} mr-3 mt-1"></i>
                    <div>
                        <div class="font-medium {% if action.priority == 'high' %}text-red-800{% elif action.priority == 'medium' %}text-orange-800{% else %}text-blue-800{% endif %}">{{ action.title }}</div>
                        <div class="text-sm {% if action.priority == 'high' %}text-red-700{% elif action.priority == 'medium' %}text-orange-700{% else %}text-blue-700{% endif %}">{{ action.desc }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Insights & Tips
            </h3>
            <div class="space-y-4">
                {% set insight_colors = ['yellow', 'purple', 'indigo', 'green', 'blue'] %}
                {% for insight in ai_recommendations.insights %}
                {% set color = insight_colors[loop.index0 % insight_colors|length] %}
                <div class="p-3 bg-{{ color }}-50 rounded-lg">
                    <div class="font-medium text-{{ color }}-800 mb-2">{{ insight.title }}</div>
                    <div class="text-sm text-{{ color }}-700">{{ insight.desc }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script nonce="{{ g.csp_nonce }}" src="{{ url_for('static', filename='js/inline_extracted/progress_inline_1.js') }}"></script>
{% endblock %}