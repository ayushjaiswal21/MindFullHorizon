{% extends 'base.html' %}

{% block title %}Medication Tracker - MindFull Horizon{% endblock %}

{% block content %}
<div class="container mx-auto mt-10 p-6">
    <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center">Medication Tracker</h1>

    <!-- Add New Medication Form -->
    <div class="bg-white p-8 rounded-lg shadow-lg mb-10 max-w-2xl mx-auto">
        <h2 class="text-2xl font-semibold text-gray-700 mb-6">Add a New Medication</h2>
        <form action="{{ url_for('patient.medication') }}" method="POST" class="space-y-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div>
                <label for="name" class="block text-sm font-medium text-gray-600">Medication Name</label>
                <input type="text" id="name" name="name" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div>
                <label for="dosage" class="block text-sm font-medium text-gray-600">Dosage (e.g., 10mg, 1 tablet)</label>
                <input type="text" id="dosage" name="dosage" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div>
                <label for="frequency" class="block text-sm font-medium text-gray-600">Frequency (e.g., Daily, Twice a day)</label>
                <input type="text" id="frequency" name="frequency" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div>
                <label for="time_of_day" class="block text-sm font-medium text-gray-600">Time of Day (e.g., Morning, Bedtime)</label>
                <input type="text" id="time_of_day" name="time_of_day" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">Add Medication</button>
        </form>
    </div>

    <!-- Daily Medication Tracker -->
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-4xl mx-auto">
        <h2 class="text-2xl font-semibold text-gray-700 mb-6">Daily Tracker for {{ moment.now().strftime('%B %d, %Y') if moment else 'Today' }}</h2>
        {% if medications %}
            <ul class="space-y-4">
                {% for med in medications %}
                    <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <div>
                            <p class="font-semibold text-lg text-gray-800">{{ med.name }}</p>
                            <p class="text-sm text-gray-500">{{ med.dosage }} - {{ med.frequency }}{% if med.time_of_day %} ({{ med.time_of_day }}){% endif %}</p>
                        </div>
                        <form action="{{ url_for('log_medication') }}" method="POST">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <input type="hidden" name="medication_id" value="{{ med.id }}">
                            {% if med.id in logged_med_ids %}
                                <button type="button" class="bg-green-500 text-white font-bold py-2 px-4 rounded-md cursor-not-allowed" disabled>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                                    Logged
                                </button>
                            {% else %}
                                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-150 ease-in-out">Log as Taken</button>
                            {% endif %}
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-center text-gray-500">You haven't added any medications yet. Use the form above to get started.</p>
        {% endif %}
    </div>
</div>



{% endblock %}
